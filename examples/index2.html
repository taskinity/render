<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taskinity Render - Local Preview</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #24292e;
            max-width: 1012px;
            margin: 0 auto;
            padding: 16px;
        }
        pre {
            background-color: #f6f8fa;
            border-radius: 6px;
            padding: 16px;
            overflow: auto;
        }
        .taskinity-diagram {
            margin: 1em 0;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            padding: 16px;
            background: white;
        }
    </style>
</head>
<body>
    <h1>Taskinity Render - Local Preview</h1>
    
    <h2>DSL Example</h2>
    
    <pre><code class="language-dsl">flow EmailProcessing:
    description: "Email Processing Flow"
    fetch_emails -> classify_emails
    classify_emails -> process_urgent_emails
    classify_emails -> process_regular_emails
    
    # This is a comment
    process_urgent_emails -> send_urgent_notifications
    process_regular_emails -> archive_emails</code></pre>

    <h2>Another Example</h2>
    
    <pre><code class="language-dsl">flow UserRegistration:
    description: "User Registration Flow"
    start -> validate_input
    validate_input -> check_email_availability
    check_email_availability -> create_user_account
    create_user_account -> send_welcome_email
    send_welcome_email -> complete_registration</code></pre>

    <!-- Load Taskinity Render -->
    <script>
        // Configuration object
        window.taskinityRenderConfig = {
            theme: 'github',
            lineNumbers: true,
            copyButton: true
        };

        // Function to show error message
        function showError(message) {
            console.error(message);
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = 'background: #ffebee; border-left: 4px solid #f44336; color: #b71c1c; padding: 1em; margin: 1em 0; border-radius: 4px;';
            errorDiv.innerHTML = `
                <h3 style="margin-top: 0;">Error loading Taskinity Render</h3>
                <p>${message}</p>
                <p>If the problem persists, please <a href="https://github.com/taskinity/render/issues" target="_blank">report this issue</a>.</p>
            `;
            document.body.insertBefore(errorDiv, document.body.firstChild);
        }

        // Function to load script
        function loadScript(src, onSuccess, onError) {
            const script = document.createElement('script');
            script.src = src;
            script.onload = onSuccess;
            script.onerror = onError || function() {
                console.error('Failed to load script:', src);
            };
            document.head.appendChild(script);
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            // Try to load from local dist first (for development)
            loadScript(
                '../dist/taskinity-render.min.js',
                // On success
                () => {
                    try {
                        if (typeof TaskinityRender === 'function') {
                            window.taskinityRender = new TaskinityRender(window.taskinityRenderConfig);
                            console.log('Taskinity Render initialized successfully from local dist!');
                        } else {
                            throw new Error('TaskinityRender is not defined');
                        }
                    } catch (error) {
                        console.error('Error initializing from local dist, trying CDN...', error);
                        // Fallback to CDN if local fails
                        loadScript(
                            'https://cdn.jsdelivr.net/npm/taskinity-render/dist/taskinity-render.min.js',
                            () => {
                                try {
                                    window.taskinityRender = new TaskinityRender(window.taskinityRenderConfig);
                                    console.log('Taskinity Render initialized from CDN!');
                                } catch (e) {
                                    showError('Failed to initialize from CDN: ' + e.message);
                                }
                            },
                            () => showError('Failed to load Taskinity Render from any source')
                        );
                    }
                },
                // On error
                () => {
                    console.log('Local dist load failed, trying CDN...');
                    loadScript(
                        'https://cdn.jsdelivr.net/npm/taskinity-render/dist/taskinity-render.min.js',
                        () => {
                            try {
                                window.taskinityRender = new TaskinityRender(window.taskinityRenderConfig);
                                console.log('Taskinity Render initialized from CDN!');
                            } catch (e) {
                                showError('Failed to initialize from CDN: ' + e.message);
                            }
                        },
                        () => showError('All script loading attempts failed')
                    );
                }
            );
        });
    </script>
</body>
</html>
